!function(){"use strict";const e=e=>e.getBoundingClientRect();class t extends window.HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}).innerHTML='<style type="text/css">*, *:before, *:after {\n  box-sizing: border-box;\n}\n\n:host {\n  display: block;\n}\n\nol {\n  counter-reset: item;\n}\n\nli {\n  display: block;\n  font-size: .9em;\n  border: 1px solid transparent;\n}\n\nli[data-placeholder] {\n  border: 1px dashed #aaa;\n  background: #eee;\n}\n\nli[data-trash] {\n  outline: 2px solid red;\n  outline-offset: .5em;\n}\n\nli:before {\n  content: counters(item, ".") " ";\n  counter-increment: item;\n  font-variant-numeric: tabular-nums;\n  font-family: monospace;\n  vertical-align: top;\n  cursor: grab;\n}\n\ntextarea {\n  font-size: inherit;\n  font-family: inherit;\n}</style><div id="root">\n  <ol id="list">\n</ol></div>',this._$list=this.shadowRoot.getElementById("list"),this.resetDrag(),this._$list.addEventListener("keydown",(e=>this.keyDown(e))),this._$list.addEventListener("keyup",(e=>this.keyUp(e)))}init(){const e=this.item();this._$list.appendChild(e),this.spotlight(e)}connectedCallback(){this.init()}keyDown(e){switch(e.key.toLowerCase()){case"tab":return this.tab(e);case"enter":return this.enter(e);case"backspace":return this.backspace(e);case"arrowdown":case"arrowup":return this.handleArrow(e);default:return}}keyUp(e){this.handleArrow(e)}handleArrow(e){const t=["ArrowUp","ArrowDown"];if(!t.includes(e.key))return;const{selectionStart:n,selectionEnd:r}=e.target;n===r&&("keyup"===e.type&&e.target.dataset.caret==n&&this.moveCaret(e.target,t.indexOf(e.key)),e.target.dataset.caret=n)}moveCaret(e,t){const n=[...this._$list.querySelectorAll("textarea")],r=n[Math.max(Math.min(n.length,n.indexOf(e)+(2*t-1)),0)];if(!r||e===r)return;const i=[r.value.length,0][t];r.focus(),r.setSelectionRange(i,i)}tab(e){e.preventDefault();const t=e.target.closest("li"),n=e.shiftKey?t.parentElement?.closest("li")?.parentElement:t?.previousElementSibling?.querySelector("ol");n?.appendChild(t),this.spotlight(t)}spotlight(e){e?.querySelector("textarea")?.focus()}enter(e){e?.preventDefault();const t=e.target.closest("li"),n=this.item();t.insertAdjacentElement("afterend",n),this.spotlight(n)}backspace(e){if(""!==e.target.value)return;e.preventDefault();const t=e.target;t.closest("ol").append(...t.nextElementSibling.children),t.parentElement.remove(),this._$list.children.length||this.init(),[...this._$list.querySelectorAll("textarea")].at(-1).focus()}item(){const e=document.createElement("li"),t=document.createElement("textarea");t.setAttribute("contenteditable","plaintext-only"),t.setAttribute("rows",1);const n=document.createElement("ol");return e.appendChild(t),e.appendChild(n),e.addEventListener("pointerdown",(e=>this.onMouseDown(e))),e}resetDrag(){this._drag={x:0,y:0,target:null,placeholder:null,mousemove:Function.prototype,mouseup:Function.prototype}}getPlaceholder(e){const t=document.createElement("li");return t.dataset.placeholder=!0,t.style.height=`${e.height}px`,t.style.width=`${e.width}px`,t}handlePlaceholder(t){const n=[...this.shadowRoot.elementsFromPoint(t.pageX,t.pageY)];if(n.includes(this._drag.placeholder))return;const r=n.find((e=>"li"===e.tagName.toLowerCase()&&![this._drag.target,this._drag.placeholder].includes(e)));if(!r)return;const i=e(r).top>t.pageY-this._drag.y?"beforebegin":"afterend";r.insertAdjacentElement(i,this._drag.placeholder)}onMouseDown(t){if(t.target!==t.currentTarget)return;const n=e(t.target),r=n.left,i=n.top;this._drag={target:t.target,placeholder:this.getPlaceholder(n),x:t.pageX-r,y:t.pageY-i,mousemove:this.onMouseMove.bind(this),mouseup:this.onMouseUp.bind(this)},t.target.dataset.dragging=!0,t.target.parentElement.insertBefore(this._drag.placeholder,this._drag.target),Object.assign(this._drag.target.style,{width:`${n.width}px`,height:`${n.height}px`,position:"absolute",left:`${r}px`,top:`${i}px`}),document.addEventListener("pointermove",this._drag.mousemove),document.addEventListener("pointerup",this._drag.mouseup)}onMouseMove(e){const t=e.pageX-this._drag.x,n=e.pageY-this._drag.y;Object.assign(this._drag.target.style,{left:`${t}px`,top:`${n}px`}),this.handlePlaceholder(e)}onMouseUp(){document.removeEventListener("pointermove",this._drag.mousemove),document.removeEventListener("pointerup",this._drag.mouseup),this._drag.placeholder.parentElement.insertBefore(this._drag.target,this._drag.placeholder),this._drag.target.removeAttribute("style"),this._drag.target.removeAttribute("data-dragging"),this._drag.placeholder.remove(),this.spotlight(this._drag.target),this._drag.target.hasAttribute("data-trash")&&this._drag.target.remove(),this._$list.children.length||this.init(),this.resetDrag()}}window.customElements.define("inline-outline",t)}();
